<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictor Pro AI v4.0 - Real Data Powered</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-4 border border-white/20 shadow-xl">
            <div class="flex items-center gap-3 mb-2">
                <svg class="w-8 h-8 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
                <div>
                    <h1 class="text-2xl font-bold text-white">Predictor Pro AI v4.0</h1>
                    <p class="text-gray-300 text-xs">Datos REALES de Polymarket API + An√°lisis Grok</p>
                </div>
            </div>
        </div>

        <!-- Configuraci√≥n Simple -->
        <div id="inputSection" class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-4 border border-white/20 shadow-xl">
            <h2 class="text-xl font-semibold text-white mb-4">üéØ An√°lisis Inteligente</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="text-white font-medium block mb-2">üîë xAI API Key</label>
                    <div class="flex gap-2">
                        <input type="password" id="apiKey" placeholder="xai-..." 
                            class="flex-1 bg-white/20 border border-white/30 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:ring-2 focus:ring-cyan-400 outline-none">
                        <button onclick="saveApiKey()" class="bg-green-600 hover:bg-green-700 px-4 rounded-lg text-white font-medium">
                            üíæ Guardar
                        </button>
                    </div>
                    <p class="text-gray-400 text-xs mt-1">
                        Obt√©n gratis en <a href="https://x.ai/api" target="_blank" class="text-cyan-400 underline">x.ai/api</a> 
                        ($25 cr√©ditos gratis) ‚Ä¢ Se guardar√° localmente
                    </p>
                </div>

                <div>
                    <label class="text-white font-medium block mb-2">üîó URL del Mercado (Polymarket)</label>
                    <input type="text" id="marketUrl" 
                        placeholder="https://polymarket.com/event/bitcoin-price-on-november-4?tid=..."
                        class="w-full bg-white/20 border border-white/30 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:ring-2 focus:ring-cyan-400 outline-none">
                    <p class="text-gray-400 text-xs mt-1">
                        ‚ö° Extraemos datos REALES via API p√∫blica de Polymarket (sin key adicional)
                    </p>
                </div>

                <div class="bg-green-900/30 border border-green-700/50 rounded-lg p-4">
                    <div class="flex items-start gap-2">
                        <svg class="w-5 h-5 text-green-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-green-200 text-sm">
                            <strong>100% Automatizado:</strong> Extraemos datos REALES de Polymarket API (sin key adicional). 
                            Grok solo analiza factores cualitativos. ¬°Cero trabajo manual!
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="analyzeMarketSmart()" 
                class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-4 px-6 rounded-xl font-bold mt-6 transition-all transform hover:scale-[1.02] shadow-2xl">
                üöÄ Analizar con Grok-3
            </button>
        </div>

        <!-- Loading Mejorado -->
        <div id="loading" class="hidden bg-white/10 backdrop-blur-lg rounded-2xl p-8 mb-4 border border-white/20 shadow-xl">
            <div class="flex flex-col items-center">
                <svg class="w-16 h-16 text-cyan-400 animate-spin mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <p class="text-white text-xl font-semibold mb-2">Analizando con Grok-3...</p>
                <p id="loadingStatus" class="text-gray-400 text-sm">Extrayendo datos del mercado...</p>
                <div class="mt-4 w-full bg-white/20 rounded-full h-2">
                    <div id="progressBar" class="bg-cyan-400 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Resultados -->
        <div id="results" class="hidden space-y-4"></div>
    </div>

    <script>
        // ============================================================================
        // CONFIGURACI√ìN
        // ============================================================================
        
        const CONFIG = {
            xaiEndpoint: 'https://api.x.ai/v1/chat/completions',
            xaiModel: 'grok-beta',
            polymarketAPI: 'https://gamma-api.polymarket.com',
            corsProxy: 'https://api.allorigins.win/raw?url=',
            prior: 0.50,
            evThresholdBuy: 0.15,
            evThresholdSkip: -0.15
        };

        const WEIGHT_PROFILES = {
            crypto: { hist: 0.15, ctx: 0.05, analog: 0.20, ext: 0.25, mkt: 0.10, sent: 0.20, liq: 0.05 },
            earnings: { hist: 0.35, ctx: 0.20, analog: 0.15, ext: 0.10, mkt: 0.10, sent: 0.05, liq: 0.05 },
            politics: { hist: 0.20, ctx: 0.20, analog: 0.15, ext: 0.10, mkt: 0.05, sent: 0.25, liq: 0.05 },
            sports: { hist: 0.30, ctx: 0.15, analog: 0.25, ext: 0.05, mkt: 0.15, sent: 0.05, liq: 0.05 },
            default: { hist: 0.25, ctx: 0.15, analog: 0.20, ext: 0.15, mkt: 0.10, sent: 0.10, liq: 0.05 }
        };

        // ============================================================================
        // GESTI√ìN DE API KEY
        // ============================================================================

        function loadApiKey() {
            const saved = localStorage.getItem('xai_api_key');
            if (saved) {
                document.getElementById('apiKey').value = saved;
            }
        }

        function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                localStorage.setItem('xai_api_key', key);
                alert('‚úÖ API Key guardada localmente');
            }
        }

        window.addEventListener('DOMContentLoaded', loadApiKey);

        // ============================================================================
        // FASE 1: EXTRACCI√ìN REAL CON API DE POLYMARKET
        // ============================================================================

        async function extractMarketData(marketUrl) {
            try {
                const slugMatch = marketUrl.match(/event\/([^?]+)/);
                if (!slugMatch) {
                    throw new Error('URL inv√°lida. Formato: https://polymarket.com/event/nombre-mercado');
                }
                
                const slug = slugMatch[1];
                const response = await fetch(`${CONFIG.polymarketAPI}/events?slug=${slug}`);
                
                if (!response.ok) {
                    throw new Error(`Error API Polymarket: ${response.status}`);
                }

                const events = await response.json();
                
                if (!events || events.length === 0) {
                    throw new Error('Mercado no encontrado');
                }

                const event = events[0];
                
                let category = 'default';
                const title = event.title.toLowerCase();
                if (title.includes('bitcoin') || title.includes('btc') || title.includes('eth') || title.includes('crypto')) {
                    category = 'crypto';
                } else if (title.includes('earning') || title.includes('mentions')) {
                    category = 'earnings';
                } else if (title.includes('election') || title.includes('president') || title.includes('trump') || title.includes('harris')) {
                    category = 'politics';
                } else if (title.includes('super bowl') || title.includes('nba') || title.includes('nfl')) {
                    category = 'sports';
                }

                const outcomes = event.markets.map(market => {
                    const yesPrice = parseFloat(market.outcomePrices[0]) || 0.5;
                    
                    return {
                        name: market.question || market.groupItemTitle || 'Yes',
                        prob: yesPrice,
                        volume_usd: parseFloat(market.volume) || 0,
                        liquidity: parseFloat(market.liquidity) || 0
                    };
                });

                const type = event.markets.length > 1 ? 'multi' : 'binary';

                return {
                    title: event.title,
                    type: type,
                    context: event.description || event.title,
                    market_category: category,
                    outcomes: outcomes,
                    end_date: event.endDate,
                    total_volume: outcomes.reduce((sum, o) => sum + o.volume_usd, 0)
                };

            } catch (error) {
                console.error('Error extrayendo market data:', error);
                throw error;
            }
        }

        // ============================================================================
        // FASE 2: AN√ÅLISIS CUALITATIVO CON GROK
        // ============================================================================

        async function getGrokScores(outcome, marketContext, marketCategory, apiKey) {
            const prompt = `Analiza objetivamente este outcome en un mercado de predicci√≥n:

**Mercado**: ${marketContext}
**Outcome espec√≠fico**: ${outcome}
**Categor√≠a**: ${marketCategory}

Dame scores 0.00-1.00 (0.50 = neutral) para:

1. **hist**: Precedentes hist√≥ricos que apoyen este outcome
2. **ctx**: Catalizadores/noticias actuales que lo favorezcan  
3. **analog**: Frecuencia de este outcome en casos similares pasados
4. **ext**: Factores externos (macro, regulatorios) que influyan
5. **sent**: Sentiment en redes sociales/news (0.20=muy negativo, 0.80=muy positivo)

**IMPORTANTE**:
- Prior neutral: 0.50
- Solo desv√≠ate con evidencia concreta
- S√© objetivo, no optimista ni pesimista por defecto

**OUTPUT JSON puro**:
{"hist": 0.XX, "ctx": 0.XX, "analog": 0.XX, "ext": 0.XX, "sent": 0.XX}`;

            try {
                const response = await fetch(CONFIG.xaiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: CONFIG.xaiModel,
                        messages: [
                            {role: 'system', content: 'Analista cuantitativo objetivo. Output JSON puro.'},
                            {role: 'user', content: prompt}
                        ],
                        temperature: 0.1,
                        max_tokens: 200
                    })
                });

                if (!response.ok) throw new Error(`API error: ${response.status}`);

                const data = await response.json();
                let content = data.choices[0].message.content;

                if (content.includes('```json')) {
                    content = content.split('```json')[1].split('```')[0].trim();
                } else if (content.includes('```')) {
                    content = content.split('```')[1].split('```')[0].trim();
                }

                const scores = JSON.parse(content);

                ['hist', 'ctx', 'analog', 'ext', 'sent'].forEach(cat => {
                    if (!(cat in scores)) scores[cat] = 0.50;
                    scores[cat] = Math.max(0.0, Math.min(1.0, parseFloat(scores[cat])));
                });

                return scores;

            } catch (error) {
                console.error('Error obteniendo scores:', error);
                return { hist: 0.50, ctx: 0.50, analog: 0.50, ext: 0.50, sent: 0.50 };
            }
        }

        // ============================================================================
        // C√ÅLCULO BAYESIANO
        // ============================================================================

        function calculateBayesian(scores, weights, marketProb, liquidityScore) {
            scores.mkt = marketProb;
            scores.liq = liquidityScore;

            const weightedSum = Object.keys(weights).reduce((sum, cat) => 
                sum + weights[cat] * (scores[cat] || 0.50), 0);

            const posterior = (weightedSum + CONFIG.prior) / 2;

            const scoreValues = Object.values(scores);
            const variance = scoreValues.reduce((sum, s) => 
                sum + Math.pow(s - weightedSum, 2), 0) / scoreValues.length;
            const confidence = 1.0 - Math.min(variance, 0.3);

            let finalProb = posterior * confidence + CONFIG.prior * (1 - confidence);
            finalProb = Math.max(0.01, Math.min(0.99, finalProb));

            return { probability: finalProb, confidence, posterior, weightedSum };
        }

        // ============================================================================
        // AN√ÅLISIS PRINCIPAL
        // ============================================================================

        async function analyzeMarketSmart() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const marketUrl = document.getElementById('marketUrl').value.trim();

            if (!apiKey) {
                alert('‚ö†Ô∏è Ingresa tu xAI API Key');
                return;
            }

            if (!marketUrl) {
                alert('‚ö†Ô∏è Ingresa la URL del mercado de Polymarket');
                return;
            }

            document.getElementById('inputSection').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            updateProgress(10, 'üì° Conectando con API de Polymarket...');

            let marketData;
            try {
                marketData = await extractMarketData(marketUrl);
                updateProgress(30, `‚úÖ Datos extra√≠dos: ${marketData.outcomes.length} outcomes encontrados`);
            } catch (error) {
                showError(`No se pudo extraer la informaci√≥n: ${error.message}`);
                return;
            }

            updateProgress(40, 'üß† Analizando factores cualitativos con Grok...');

            const marketCategory = marketData.market_category || 'default';
            const weights = WEIGHT_PROFILES[marketCategory] || WEIGHT_PROFILES.default;
            const results = [];

            for (let i = 0; i < marketData.outcomes.length; i++) {
                const outcome = marketData.outcomes[i];
                const progress = 40 + (50 * (i + 1) / marketData.outcomes.length);
                updateProgress(progress, `Analizando: ${outcome.name.substring(0, 30)}...`);

                const totalVolume = marketData.total_volume || 1;
                const liquidityScore = Math.min(0.95, 0.5 + (outcome.liquidity / totalVolume) * 0.45);

                const scores = await getGrokScores(
                    outcome.name,
                    marketData.context,
                    marketCategory,
                    apiKey
                );

                const bayesianResult = calculateBayesian(scores, weights, outcome.prob, liquidityScore);
                const ev = bayesianResult.probability - outcome.prob;

                let verdict = '‚öñÔ∏è NEUTRAL';
                if (ev > CONFIG.evThresholdBuy) verdict = 'üî• COMPRA';
                else if (ev < CONFIG.evThresholdSkip) verdict = 'üö® SKIP';

                let bias = 'Neutral';
                const diff = bayesianResult.probability - outcome.prob;
                if (Math.abs(diff) < 0.05) bias = 'Neutral';
                else if (diff > 0.15) bias = 'Mercado Pesimista';
                else if (diff < -0.15) bias = 'Mercado Optimista';
                else if (diff > 0) bias = 'Leve subestimaci√≥n';
                else bias = 'Leve sobreestimaci√≥n';

                results.push({
                    name: outcome.name,
                    marketProb: outcome.prob,
                    ourProb: bayesianResult.probability,
                    ev: ev,
                    bias: bias,
                    verdict: verdict,
                    confidence: bayesianResult.confidence,
                    volume: outcome.volume_usd || 0,
                    liquidity: outcome.liquidity || 0,
                    scores: scores
                });

                await new Promise(resolve => setTimeout(resolve, 800));
            }

            updateProgress(100, '‚ú® Generando reporte final...');
            results.sort((a, b) => b.ev - a.ev);
            await new Promise(resolve => setTimeout(resolve, 500));
            displayResults(results, marketData, weights, marketCategory);
        }

        // ============================================================================
        // UI HELPERS
        // ============================================================================

        function updateProgress(percent, status) {
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('loadingStatus').textContent = status;
        }

        function showError(message) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('inputSection').classList.remove('hidden');
            alert(`‚ùå Error: ${message}`);
        }

        // ============================================================================
        // DISPLAY RESULTADOS
        // ============================================================================

        function displayResults(results, marketData, weights, category) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            let html = `
                <div class="bg-gradient-to-r from-cyan-500 to-blue-600 rounded-2xl p-6 border border-white/20 shadow-xl">
                    <h2 class="text-2xl font-bold text-white mb-3">üìä ${marketData.title}</h2>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="bg-white/20 rounded-lg p-3">
                            <div class="text-cyan-100 mb-1">Tipo</div>
                            <div class="text-white font-semibold">${marketData.type === 'binary' ? 'üîò Binario' : 'üéØ Multi-outcome'}</div>
                        </div>
                        <div class="bg-white/20 rounded-lg p-3">
                            <div class="text-cyan-100 mb-1">Categor√≠a</div>
                            <div class="text-white font-semibold">${category.toUpperCase()}</div>
                        </div>
                        <div class="bg-white/20 rounded-lg p-3">
                            <div class="text-cyan-100 mb-1">Volumen Total</div>
                            <div class="text-white font-semibold">$${(marketData.total_volume/1000).toFixed(0)}k</div>
                        </div>
                        <div class="bg-white/20 rounded-lg p-3">
                            <div class="text-cyan-100 mb-1">Outcomes</div>
                            <div class="text-white font-semibold">${results.length}</div>
                        </div>
                    </div>
                    <div class="mt-3 text-cyan-100 text-sm">${marketData.context.substring(0, 200)}...</div>
                    <div class="mt-2 text-cyan-200 text-xs">
                        ‚úÖ Datos REALES extra√≠dos de Polymarket API
                    </div>
                </div>
            `;

            const buys = results.filter(r => r.verdict === 'üî• COMPRA');
            if (buys.length > 0) {
                html += `
                    <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 shadow-xl">
                        <h3 class="text-xl font-bold text-white mb-4">üî• TOP OPORTUNIDADES (${buys.length})</h3>
                        <div class="space-y-3">
                `;

                for (const r of buys.slice(0, 5)) {
                    html += `
                        <div class="bg-gradient-to-r from-green-900/40 to-emerald-900/40 border border-green-700/50 rounded-lg p-4">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-white font-semibold text-lg">${r.name}</span>
                                <span class="text-green-400 font-bold text-2xl">+${(r.ev*100).toFixed(1)}%</span>
                            </div>
                            <div class="grid grid-cols-3 gap-3 text-sm mb-2">
                                <div>
                                    <div class="text-gray-400">Mercado</div>
                                    <div class="text-white font-medium">${(r.marketProb*100).toFixed(1)}%</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">Nuestra</div>
                                    <div class="text-white font-medium">${(r.ourProb*100).toFixed(1)}%</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">Confianza</div>
                                    <div class="text-white font-medium">${(r.confidence*100).toFixed(0)}%</div>
                                </div>
                            </div>
                            <div class="flex justify-between items-center text-xs">
                                <span class="text-yellow-300">${r.bias}</span>
                                ${r.volume > 0 ? `<span class="text-gray-400">Vol: $${(r.volume/1000).toFixed(0)}k</span>` : ''}
                            </div>
                        </div>
                    `;
                }

                html += '</div></div>';
            }

            html += `
                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 shadow-xl">
                    <h3 class="text-xl font-bold text-white mb-4">üìã An√°lisis Completo (${results.length} outcomes)</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-white/20">
                                    <th class="text-left text-gray-300 py-2">Outcome</th>
                                    <th class="text-right text-gray-300 py-2">Market</th>
                                    <th class="text-right text-gray-300 py-2">Nuestra</th>
                                    <th class="text-right text-gray-300 py-2">EV</th>
                                    <th class="text-center text-gray-300 py-2">Veredicto</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            for (const r of results) {
                const evColor = r.ev > 0 ? 'text-green-400' : (r.ev < 0 ? 'text-red-400' : 'text-gray-400');
                html += `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                        <td class="py-3 text-white">${r.name}</td>
                        <td class="text-right text-gray-300">${(r.marketProb*100).toFixed(1)}%</td>
                        <td class="text-right text-white font-medium">${(r.ourProb*100).toFixed(1)}%</td>
                        <td class="text-right ${evColor} font-bold">${r.ev > 0 ? '+' : ''}${(r.ev*100).toFixed(1)}%</td>
                        <td class="text-center">${r.verdict}</td>
                    </tr>
                `;
            }

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            if (buys.length > 0) {
                const totalEV = buys.reduce((sum, r) => sum + r.ev, 0);
                html += `
                    <div class="bg-gradient-to-r from-purple-900/50 to-pink-900/50 rounded-2xl p-6 border border-white/20 shadow-xl">
                        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
                            üí∞ Portfolio Sugerido
                        </h3>
                        <div class="bg-green-900/30 border border-green-700/50 rounded-lg p-4 mb-4">
                            <div class="text-green-400 font-bold text-3xl mb-1">
                                EV Total: +${(totalEV*100).toFixed(1)}%
                            </div>
                            <div class="text-gray-300 text-sm">
                                Distribuye equitativamente en top ${Math.min(5, buys.length)} oportunidades
                            </div>
                        </div>
                        <div class="space-y-2">
                `;

                const topBuys = buys.slice(0, 5);
                const weight = 100 / topBuys.length;

                for (const r of topBuys) {
                    html += `
                        <div class="flex justify-between items-center bg-white/5 rounded-lg p-3">
                            <span class="text-white">${r.name.substring(0, 45)}</span>
                            <span class="text-cyan-400 font-bold">${weight.toFixed(0)}%</span>
                        </div>
                    `;
                }

                html += '</div></div>';
            }

            html += `
                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 shadow-xl">
                    <h3 class="text-xl font-bold text-white mb-3">üß† Metodolog√≠a</h3>
                    <div class="space-y-2 text-sm text-gray-300">
                        <div class="flex justify-between">
                            <span>Modelo:</span>
                            <span class="text-white">Bayesiano v4.0 + Grok-3</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Categor√≠as:</span>
                            <span class="text-white">7 (hist, ctx, analog, ext, mkt, sent, liq)</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Prior neutral:</span>
                            <span class="text-white">0.50</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Pesos din√°micos:</span>
                            <span class="text-white">${category.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-white/20">
                        <div class="text-xs text-gray-400">
                            <strong class="text-white">Datos de Polymarket API (reales):</strong> Probabilidades, volumen, liquidez<br>
                            <strong class="text-white">An√°lisis Grok (cualitativo):</strong> hist, ctx, analog, ext, sent<br>
                            <strong class="text-white">Ponderaci√≥n usada:</strong> ${Object.entries(weights).map(([k, v]) => `${k}: ${(v*100).toFixed(0)}%`).join(' | ')}
                        </div>
                    </div>
                </div>
            `;

            html += `
                <button onclick="resetAnalysis()" 
                    class="w-full bg-white/20 hover:bg-white/30 text-white py-3 px-6 rounded-xl font-semibold transition-all flex items-center justify-center gap-2 mt-4">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Analizar Otro Mercado
                </button>
            `;

            resultsDiv.innerHTML = html;
            document.getElementById('loading').classList.add('hidden');
            resultsDiv.classList.remove('hidden');
        }

        function resetAnalysis() {
            document.getElementById('inputSection').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
        }
    </script>
</body>
</html>